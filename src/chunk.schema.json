{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Chunk",
  "type": "object",
  "additionalProperties": false,
  "required": ["id", "name", "instrument", "steps"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique chunk identifier"
    },
    "name": {
      "type": "string",
      "description": "Human-friendly chunk name"
    },
    "instrument": {
      "type": "string",
      "description": "Maps to Tone.js instrument"
    },
    "steps": {
      "type": "array",
      "description": "16-step pattern (1 = hit, 0 = rest)",
      "items": {
        "type": "integer",
        "enum": [0, 1]
      },
      "minItems": 16,
      "maxItems": 16
    },
    "velocities": {
      "type": "array",
      "description": "Per-step hit intensity",
      "items": {
        "type": "number",
        "minimum": 0,
        "maximum": 1
      },
      "minItems": 16,
      "maxItems": 16
    },
    "pitches": {
      "type": "array",
      "description": "Per-step pitch shift in semitones",
      "items": {
        "type": "number",
        "minimum": -12,
        "maximum": 12
      },
      "minItems": 16,
      "maxItems": 16
    },
    "note": {
      "type": "string",
      "description": "Pitch or root note"
    },
    "sustain": {
      "type": "number",
      "description": "Default note length in seconds",
      "minimum": 0
    },
    "attack": {
      "type": "number",
      "description": "Envelope attack time in seconds",
      "minimum": 0
    },
    "glide": {
      "type": "number",
      "description": "Portamento time in seconds",
      "minimum": 0
    },
    "pan": {
      "type": "number",
      "description": "Stereo pan position",
      "minimum": -1,
      "maximum": 1
    },
    "reverb": {
      "type": "number",
      "description": "Reverb wet mix",
      "minimum": 0,
      "maximum": 1
    },
    "delay": {
      "type": "number",
      "description": "Delay wet mix",
      "minimum": 0,
      "maximum": 1
    },
    "distortion": {
      "type": "number",
      "description": "Distortion amount",
      "minimum": 0,
      "maximum": 1
    },
    "bitcrusher": {
      "type": "number",
      "description": "Bitcrusher wet mix",
      "minimum": 0,
      "maximum": 1
    },
    "filter": {
      "type": "number",
      "description": "Normalized low-pass filter cutoff",
      "minimum": 0,
      "maximum": 1
    },
    "chorus": {
      "type": "number",
      "description": "Chorus wet mix",
      "minimum": 0,
      "maximum": 1
    },
    "timingMode": {
      "type": "string",
      "description": "Whether the pattern follows BPM sync or free timing",
      "enum": ["sync", "free"]
    },
    "tonalCenter": {
      "type": "string",
      "description": "Arpeggiator tonal center"
    },
    "scale": {
      "type": "string",
      "description": "Scale or mode name"
    },
    "degree": {
      "type": "integer",
      "description": "Scale degree index",
      "minimum": 0,
      "maximum": 6
    },
    "velocityFactor": {
      "type": "number",
      "description": "Global velocity multiplier",
      "minimum": 0,
      "maximum": 2
    },
    "pitchOffset": {
      "type": "number",
      "description": "Global pitch offset in semitones",
      "minimum": -12,
      "maximum": 12
    },
    "swing": {
      "type": "number",
      "description": "Normalized swing amount",
      "minimum": 0,
      "maximum": 1
    },
    "humanize": {
      "type": "number",
      "description": "Timing randomization amount",
      "minimum": 0,
      "maximum": 1
    },
    "notes": {
      "type": "array",
      "description": "Chord notes for arpeggiator",
      "items": { "type": "string" }
    },
    "degrees": {
      "type": "array",
      "description": "Chord semitone offsets from root",
      "items": {
        "type": "number"
      }
    },
    "pitchBend": {
      "type": "number",
      "description": "Pitch bend in semitones",
      "minimum": -5,
      "maximum": 5
    },
    "style": {
      "type": "string",
      "description": "Arpeggiator style",
      "enum": ["up", "down", "up-down", "random", "unfold"]
    },
    "mode": {
      "type": "string",
      "description": "Arpeggiator playback mode",
      "enum": ["continuous", "manual"]
    },
    "arpRate": {
      "type": "string",
      "description": "Arpeggiator rate (e.g. 1/8, 1/16)"
    },
    "arpFreeRate": {
      "type": "number",
      "description": "Arpeggiator interval in milliseconds when in free timing mode",
      "minimum": 0
    },
    "arpGate": {
      "type": "number",
      "description": "Arpeggiator gate length",
      "minimum": 0,
      "maximum": 1
    },
    "arpLatch": {
      "type": "boolean",
      "description": "Whether the arpeggiator latch is enabled"
    },
    "arpOctaves": {
      "type": "integer",
      "description": "Number of octaves for arpeggiator playback",
      "minimum": 1,
      "maximum": 4
    },
    "useExtensions": {
      "type": "boolean",
      "description": "Whether to include extended chord tones"
    },
    "autopilot": {
      "type": "boolean",
      "description": "Automatically trigger arp alongside kick/snare"
    },
    "noteEvents": {
      "type": "array",
      "description": "Recorded free-time note events",
      "items": {
        "type": "object",
        "required": ["time", "duration", "note", "velocity"],
        "properties": {
          "time": { "type": "number", "minimum": 0 },
          "duration": { "type": "number", "minimum": 0 },
          "note": { "type": "string" },
          "velocity": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          }
        }
      }
    },
    "noteLoopLength": {
      "type": "number",
      "description": "Loop length in seconds for free-time note events",
      "minimum": 0
    },
    "harmoniaComplexity": {
      "type": "string",
      "description": "Selected Harmonia complexity tier",
      "enum": ["simple", "extended", "lush"]
    },
    "harmoniaTone": {
      "type": "number",
      "description": "Normalized Harmonia filter cutoff value",
      "minimum": 0,
      "maximum": 1
    },
    "harmoniaDynamics": {
      "type": "number",
      "description": "Normalized Harmonia velocity scaling",
      "minimum": 0,
      "maximum": 1
    },
    "harmoniaBass": {
      "type": "boolean",
      "description": "Whether Harmonia bass reinforcement is enabled"
    },
    "harmoniaArp": {
      "type": "boolean",
      "description": "Whether Harmonia arpeggiation is enabled"
    },
    "harmoniaPatternId": {
      "type": "string",
      "description": "Active Harmonia pattern preset identifier"
    },
    "harmoniaBorrowedLabel": {
      "type": "string",
      "description": "Selected borrowed chord label for Harmonia"
    },
    "harmoniaStepDegrees": {
      "type": "array",
      "description": "Per-step Harmonia scale degree assignments",
      "items": {
        "type": ["integer", "null"],
        "minimum": 0,
        "maximum": 6
      }
    }
  }
}
